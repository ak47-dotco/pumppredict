from flask import Flask, render_template, request, redirect, url_for
from datetime import datetime

app = Flask(__name__)

# Fake data for now (temporary storage, later youâ€™ll use a database)
users = {}
predictions = [
    {
        "id": 1,
        "title": "Will DOGE hit $1 by September?",
        "status": "Open",
        "end_time": datetime(2025, 9, 1, 12, 0)
    }
]

@app.route("/")
def home():
    return render_template("index.html")

@app.route("/predict/<int:prediction_id>", methods=["GET", "POST"])
def predict(prediction_id):
    prediction = next((p for p in predictions if p["id"] == prediction_id), None)
    if not prediction:
        return "Prediction not found", 404

    if request.method == "POST":
        username = request.form["username"]
        prediction_text = request.form["prediction"]
        exit_point = request.form.get("exit_point")
        amount = request.form["amount"]

        # Simulate storing the bet
        if username not in users:
            users[username] = {"username": username, "email": "example@email.com", "joined": "Today", "bets": []}
        users[username]["bets"].append({
            "prediction": prediction_text,
            "amount": amount,
            "status": "Open"
        })

        return redirect(url_for("account", username=username))

    return render_template("predict.html", prediction=prediction)

@app.route("/account/<username>")
def account(username):
    user = users.get(username)
    if not user:
        return "User not found", 404
    return render_template("account.html", user=user)

@app.route("/settings")
def settings():
    return render_template("settings.html")

@app.route("/admin")
def admin():
    return render_template("admin.html", predictions=predictions)

if __name__ == "__main__":
    app.run(debug=True)
